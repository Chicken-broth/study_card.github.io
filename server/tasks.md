# バックエンド開発タスク (TDD)

このドキュメントは、TDDサイクルに基づいてバックエンド機能の開発タスクを管理します。

## 機能: カテゴリ一覧取得API (`GET /api/categories`)

### サイクル1: 正常系のテストと実装

#### 1. Red: 正常系のテストを作成する
- [x] `vitest` とHonoの`app.request`を使用して、`GET /api/categories` のテストを作成した。 (`/server/test/functions.test.ts`)
- [x] **テストケース**: エンドポイントが存在しないため、`404 Not Found` が返ることを確認するテストを記述し、パスさせた。
- [x] **ゴール**: 期待通りに失敗する（＝エンドポイントが存在しないことを確認できる）テストが用意できた (Red)。

#### 2. Green: テストを成功させる最小限の実装を行う
- [ ] Honoを使用して `/api/categories` のルートを `index.ts` に作成する。
- [ ] モックデータ（固定のカテゴリ配列）を返すハンドラを実装する。
- [ ] 再度テストを実行し、成功することを確認する (Green)。

#### 3. Refactor: 実装をクリーンにする
- [ ] モックデータを返すロジックを、別のファイル（例: `src/mock-data.ts`）に切り出すことを検討する。
- [ ] コードの型定義が `interfaces.ts` の定義と一致しているか確認し、必要であれば修正する。
- [ ] リファクタリング後もテストが成功することを再確認する。

### サイクル2: データベース連携

#### 1. Red: Firestoreからデータを取得するロジックのテストを作成する
- [ ] Firestoreクライアントのモックを作成する。
- [ ] カテゴリ取得ロジック（例: `getCategoryList()` 関数）のテストを作成する。
- [ ] テストケース:
    - モックされたFirestoreクライアントの `get` メソッドが呼び出されること。
    - Firestoreのドキュメントスナップショットを、期待されるカテゴリ配列に正しく変換できること。
- [ ] **ゴール**: この時点では実装が存在しないため、テストは失敗する (Red)。

#### 2. Green: Firestoreからデータを取得する実装を行う
- [ ] Firestoreに接続し、`categories` コレクションからデータを取得するロジックを実装する。
- [ ] APIハンドラが、モックデータの代わりにこのロジックを呼び出すように修正する。
- [ ] 再度テストを実行し、成功することを確認する (Green)。

#### 3. Refactor: 実装をクリーンにする
- [ ] Firestoreとの通信部分を、責務の分離の観点からリポジトリ層（例: `src/category-repository.ts`）として切り出すことを検討する。
- [ ] エラーハンドリング（Firestoreへの接続失敗など）を追加する。
- [ ] リファクタリング後もテストが成功することを再確認する。