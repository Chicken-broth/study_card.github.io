# quiz-app 実装タスク

## 概要

全タスク数: 14
推定作業時間: 28日
クリティカルパス: TASK-001 -> TASK-002 -> TASK-102 -> TASK-202 -> TASK-203 -> TASK-301

## タスク一覧

### フェーズ1: 基盤構築

#### TASK-001: バックエンドプロジェクトセットアップ (Firebase Functions)

- [ ] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: なし (基盤)
- **依存タスク**: なし
- **実装詳細**:
  - Firebase CLIのインストール
  - Firebaseプロジェクトの初期化
  - Functionsのセットアップ
- **テスト要件**:
  - [ ] Firebase Functionsのデプロイテスト
  - [ ] エミュレータでの動作確認
- **完了条件**:
  - [ ] Firebase Functionsがデプロイされ、基本的な関数が動作する

#### TASK-002: データベースセットアップ (Local Storage)

- [ ] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: なし (基盤)
- **依存タスク**: TASK-001
- **実装詳細**:
  - Local Storageを利用したデータ構造の定義（カテゴリ、問題、クイズ結果）
  - データ読み書きのヘルパー関数の実装
- **テスト要件**:
  - [ ] Local Storageへのデータ保存・読み込みテスト
- **完了条件**:
  - [ ] Local Storageにデータを保存し、読み込むことができる

#### TASK-003: フロントエンドプロジェクトセットアップ (Gleam/Lustre)

- [x] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: REQ-401
- **依存タスク**: なし
- **実装詳細**:
  - Gleam/Lustreプロジェクトの初期化
  - ビルド設定
  - 開発サーバーのセットアップ
- **テスト要件**:
  - [ ] フロントエンドアプリケーションのコンパイルと実行テスト
- **完了条件**:
  - [ ] Gleam/Lustreアプリケーションがブラウザで表示される

### フェーズ2: バックエンドAPI実装

#### TASK-101: GET /api/categories の実装 (Local Storage)

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-008, REQ-009
- **依存タスク**: TASK-002
- **実装詳細**:
  - Local Storageからカテゴリ一覧を取得するロジック
  - APIエンドポイントのルーティング (モック)
- **テスト要件**:
  - [ ] 単体テスト: カテゴリデータ取得ロジック
  - [ ] 統合テスト: モックAPIエンドポイントの動作確認
　
#### TASK-102: GET /api/questions の実装 (Local Storage)

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-001, REQ-002, REQ-010, REQ-011, REQ-012
- **依存タスク**: TASK-002, TASK-101
- **実装詳細**:
  - Local Storageから指定されたカテゴリと数に基づいて問題を取得するロジック
  - 問題のランダム選択ロジック
  - APIエンドポイントのルーティング (モック)
- **テスト要件**:
  - [ ] 単体テスト: 問題選択ロジック、ランダム化
  - [ ] 統合テスト: モックAPIエンドポイントの動作確認

#### TASK-103: POST /api/quiz-results の実装 (Local Storage)

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-004, REQ-005
- **依存タスク**: TASK-002
- **実装詳細**:
  - Local Storageにクイズ結果を保存するロジック
  - APIエンドポイントのルーティング (モック)
- **テスト要件**:
  - [ ] 単体テスト: 結果保存ロジック
  - [ ] 統合テスト: モックAPIエンドポイントの動作確認

#### TASK-104: GET /api/quiz-summary の実装 (Local Storage)

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-005, REQ-009
- **依存タスク**: TASK-002, TASK-103
- **実装詳細**:
  - Local Storageから全体の集計とカテゴリ別の集計データを取得するロジック
  - APIエンドポイントのルーティング (モック)
- **テスト要件**:
  - [ ] 単体テスト: 集計ロジック
  - [ ] 統合テスト: モックAPIエンドポイントの動作確認

### フェーズ3: フロントエンドUI実装

#### TASK-201: Home画面の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-006, REQ-010, REQ-012
- **依存タスク**: TASK-003, TASK-101
- **実装詳細**:
  - カテゴリ選択、出題数選択、クイズ開始/学習履歴ボタンのUIコンポーネント
  - `GET /api/categories` の呼び出しと表示
- **UI/UX要件**:
  - [ ] カテゴリ選択: 複数選択可能なチェックボックス
  - [ ] 出題数選択: ラジオボタン (10/20/50)
  - [ ] ボタンの活性/非活性制御
- **テスト要件**:
  - [ ] コンポーネントテスト
  - [ ] E2Eテスト: 画面遷移、カテゴリ/出題数選択

#### TASK-202: クイズ画面の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-001, REQ-002, REQ-003, REQ-101
- **依存タスク**: TASK-003, TASK-102, TASK-201
- **実装詳細**:
  - 問題文、選択肢（四択/組み合わせ）の表示コンポーネント
  - 回答ロジックと正解/不正解判定
  - `GET /api/questions` の呼び出しと表示
- **UI/UX要件**:
  - [ ] 問題の種類に応じたUI切り替え
  - [ ] 回答選択時のフィードバック
  - [ ] 進捗表示
- **テスト要件**:
  - [ ] コンポーネントテスト
  - [ ] E2Eテスト: クイズ回答フロー

#### TASK-203: リザルト画面の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-004, REQ-102
- **依存タスク**: TASK-003, TASK-103, TASK-202
- **実装詳細**:
  - クイズ結果（正解数、正解率、各問題の正解/不正解）の表示コンポーネント
  - `POST /api/quiz-results` の呼び出し
  - Homeに戻る/もう一度挑戦するボタン
- **UI/UX要件**:
  - [ ] 結果の分かりやすい表示
  - [ ] ボタンの配置と挙動
- **テスト要M件**:
  - [ ] コンポーネントテスト
  - [ ] E2Eテスト: 結果表示と遷移

#### TASK-204: 集計画面の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-005, REQ-009
- **依存タスク**: TASK-003, TASK-104, TASK-201
- **実装詳細**:
  - 全体統計、カテゴリ別統計の表示コンポーネント
  - `GET /api/quiz-summary` の呼び出しと表示
- **UI/UX要件**:
  - [ ] 統計データの分かりやすい可視化
  - [ ] Homeに戻るボタン
- **テスト要件**:
  - [ ] コンポーネントテスト
  - [ ] E2Eテスト: 集計表示と遷移

### フェーズ4: 統合・最適化

#### TASK-301: フロントエンド-バックエンド統合テスト

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: 全要件
- **依存タスク**: TASK-101, TASK-102, TASK-103, TASK-104, TASK-201, TASK-202, TASK-203, TASK-204
- **実装詳細**:
  - Cypress/PlaywrightなどのE2Eテストフレームワークのセットアップ
  - 主要なユーザーフロー（クイズ開始〜結果表示、学習履歴表示）のテストシナリオ作成と実行
- **テスト要件**:
  - [ ] 全てのAPI連携が正しく機能すること
  - [ ] ユーザーフローが期待通りに動作すること

#### TASK-302: エラーハンドリングとローディング状態の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: EDGE-001, NFR-001
- **依存タスク**: TASK-201, TASK-202, TASK-203, TASK-204
- **実装詳細**:
  - API通信中のローディングインジケータ表示
  - 通信エラー発生時のユーザーへのフィードバック（メッセージ表示、再試行オプション）
- **UI/UX要件**:
  - [ ] 一貫性のあるローディング表示
  - [ ] 分かりやすいエラーメッセージ
- **テスト要件**:
  - [ ] ネットワークエラー模擬テスト
  - [ ] ローディング状態の表示テスト

#### TASK-303: デプロイメント設定

- [ ] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: REQ-401
- **依存タスク**: TASK-101, TASK-102, TASK-103, TASK-104, TASK-201, TASK-202, TASK-203, TASK-204
- **実装詳細**:
  - バックエンドとフロントエンドのデプロイメント環境設定（例: Dockerfile, CI/CDパイプラインの初期設定）
- **テスト要件**:
  - [ ] ビルドとデプロイの成功
- **完了条件**:
  - [ ] アプリケーションが本番環境相当の環境で動作する

### フェーズ5: Firestore移行

#### TASK-401: Firestoreデータベースセットアップ
- [ ] **タスク完了**
- **タスクタイプ**: DIRECT
- **依存タスク**: TASK-001
- **実装詳細**:
  - Firestoreデータベースの作成
  - サンプルデータ（カテゴリ、問題）の投入
- **完了条件**:
  - Firestoreにデータが投入され、コンソールから確認できる

#### TASK-402: Firestoreセキュリティルール設定
- [ ] **タスク完了**
- **タスクタイプ**: DIRECT
- **依存タスク**: TASK-401
- **実装詳細**:
  - 認証されていないユーザーからの読み取りを許可（今回は認証なしのため）
  - 書き込みは制限（Functionsからのみ許可するなど）
- **完了条件**:
  - セキュリティルールがデプロイされ、意図通りにアクセス制御が行われる

#### TASK-403: GET /api/categories の実装 (Firestore)
- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **依存タスク**: TASK-401
- **実装詳細**:
  - Firestoreからカテゴリ一覧を取得するFirebase Functionsの実装
- **テスト要件**:
  - 単体テスト: Firestoreデータ取得ロジック
  - 統合テスト: APIエンドポイントの動作確認
- **完了条件**:
  - APIを叩くとFirestoreから取得したカテゴリ一覧が返却される

#### TASK-404: GET /api/questions の実装 (Firestore)
- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **依存タスク**: TASK-401
- **実装詳細**:
  - Firestoreから指定された条件で問題を取得するFirebase Functionsの実装
- **テスト要件**:
  - 単体テスト: 問題取得ロジック
  - 統合テスト: APIエンドポイントの動作確認
- **完了条件**:
  - APIを叩くとFirestoreから取得した問題データが返却される

#### TASK-405: POST /api/results の実装 (Firestore)
- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **依存タスク**: TASK-401
- **実装詳細**:
  - クイズ結果をFirestoreに保存するFirebase Functionsの実装
- **テスト要件**:
  - 単体テスト: 結果保存ロジック
  - 統合テスト: APIエンドポイントの動作確認
- **完了条件**:
  - APIを叩くと結果がFirestoreに保存される

#### TASK-406: GET /api/results の実装 (Firestore)
- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **依存タスク**: TASK-401
- **実装詳細**:
  - 過去の結果一覧をFirestoreから取得するFirebase Functionsの実装
- **テスト要件**:
  - 単体テスト: 結果取得ロジック
  - 統合テスト: APIエンドポイントの動作確認
- **完了条件**:
  - APIを叩くと過去の結果一覧がFirestoreから返却される

#### TASK-407: フロントエンドのAPI連携修正
- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **依存タスク**: TASK-201, TASK-202, TASK-203, TASK-204, TASK-403, TASK-404, TASK-405, TASK-406
- **実装詳細**:
  - フロントエンドのHTTPクライアントを、Firebase Functionsの各エンドポイントを呼び出すように修正
  - Local Storage関連のコードを削除
- **テスト要件**:
  - E2Eテスト: 実際のAPIと連携したユーザーフローのテスト
- **完了条件**:
  - フロントエンドがLocal Storageではなく、FirebaseのAPIと通信して動作する

## 実行順序

```mermaid
gantt
    title quiz-app タスク実行スケジュール (Firestore移行)
    dateFormat  YYYY-MM-DD
    axisFormat %m-%d

    section 基盤構築
    TASK-001: Firebase Setup           :done, task001, 2025-08-11, 1d
    TASK-003: Frontend Setup           :done, task003, 2025-08-11, 1d

    section Firestore移行 (バックエンド)
    TASK-401: Firestore Setup          :crit, task401, after task001, 2d
    TASK-402: Security Rules         :crit, task402, after task401, 1d
    TASK-403: API: categories (FS)   :crit, task403, after task402, 2d
    TASK-404: API: questions (FS)    :crit, task404, after task403, 3d
    TASK-405: API: post results (FS) :crit, task405, after task402, 2d
    TASK-406: API: get results (FS)  :crit, task406, after task405, 2d

    section フロントエンドUI実装
    TASK-201: Home画面                 :task201, after task403, 3d
    TASK-202: クイズ画面               :crit, task202, after task201, after task404, 4d
    TASK-203: リザルト画面             :crit, task203, after task202, after task405, 3d
    TASK-204: 集計画面                 :task204, after task201, after task406, 3d

    section 統合・最適化
    TASK-301: 統合テスト               :crit, task301, after task203, after task204, 4d
    TASK-302: エラーハンドリング       :task302, after task301, 2d
    TASK-303: デプロイメント設定       :task303, after task302, 2d
```