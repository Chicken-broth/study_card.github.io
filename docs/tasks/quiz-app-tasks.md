# quiz-app 実装タスク

## 概要

全タスク数: 14
推定作業時間: 28日
クリティカルパス: TASK-001 -> TASK-002 -> TASK-202 -> TASK-203 -> TASK-301

## タスク一覧

### フェーズ1: 基盤構築

#### TASK-001: バックエンドプロジェクトセットアップ (Firebase Functions)

- [x] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: なし (基盤)
- **依存タスク**: なし
- **実装詳細**:
  - Firebase CLIのインストール
  - Firebaseプロジェクトの初期化
  - Functionsのセットアップ
- **テスト要件**:
  - [x] Firebase Functionsのデプロイテスト
  - [x] エミュレータでの動作確認
- **完了条件**:
  - [x] Firebase Functionsがデプロイされ、基本的な関数が動作する

#### TASK-002: データベースセットアップ (IndexedDB)

- [x] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: なし (基盤)
- **依存タスク**: TASK-001
- **実装詳細**:
  - IndexedDBを利用したデータ構造の定義（カテゴリ、問題、クイズ結果）
  - データ読み書きのFFI（Foreign Function Interface）の実装
- **テスト要件**:
  - [x] IndexedDBへのデータ保存・読み込みテスト
- **完了条件**:
  - [x] IndexedDBにデータを保存し、読み込むことができる

#### TASK-003: フロントエンドプロジェクトセットアップ (Gleam/Lustre)

- [x] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: REQ-401
- **依存タスク**: なし
- **実装詳細**:
  - Gleam/Lustreプロジェクトの初期化
  - ビルド設定
  - 開発サーバーのセットアップ
- **テスト要件**:
  - [x] フロントエンドアプリケーションのコンパイルと実行テスト
- **完了条件**:
  - [x] Gleam/Lustreアプリケーションがブラウザで表示される

### フェーズ2: バックエンドAPI実装


### フェーズ3: フロントエンドUI実装

#### TASK-201: Home画面の実装

- [x] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-006, REQ-010, REQ-012
- **依存タスク**: TASK-003, TASK-101
- **実装詳細**:
  - カテゴリ選択、出題数選択、クイズ開始/学習履歴ボタンのUIコンポーネント
- **UI/UX要件**:
  - [x] カテゴリ選択: 複数選択可能なチェックボックス
  - [x] 出題数選択: ラジオボタン (10/20/50)
  - [x] ボタンの活性/非活性制御
- **テスト要件**:
  - [x] E2Eテスト: 画面遷移、カテゴリ/出題数選択

#### TASK-202: クイズ画面の実装

- [x] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-001, REQ-002, REQ-003, REQ-101
- **依存タスク**: TASK-003, TASK-102, TASK-201
- **実装詳細**:
  - 問題文、選択肢（四択/組み合わせ）の表示コンポーネント
  - 回答ロジックと正解/不正解判定
  - 組み合わせ問題の選択肢の順序をランダム化
- **UI/UX要件**:
  - [x] 問題の種類に応じたUI切り替え
  - [x] 回答選択時のフィードバック
  - [x] 進捗表示
- **テスト要件**:
  - [x] E2Eテスト: クイズ回答フロー
  - [x] 組み合わせ問題の選択肢がランダムに表示されること

#### TASK-203: リザルト画面の実装

- [x] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-004, REQ-102
- **依存タスク**: TASK-003, TASK-103, TASK-202
- **実装詳細**:
  - クイズ結果（正解数、正解率、各問題の正解/不正解）の表示コンポーネント
  - Homeに戻る/もう一度挑戦するボタン
- **UI/UX要件**:
  - [x] 結果の分かりやすい表示
  - [x] ボタンの配置と挙動
- **テスト要M件**:
  - [x] E2Eテスト: 結果表示と遷移

#### TASK-204: 集計画面の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-005, REQ-009
- **依存タスク**: TASK-003, TASK-104, TASK-201
- **実装詳細**:
  - 全体統計、カテゴリ別統計の表示コンポーネント
- **UI/UX要件**:
  - [ ] 統計データの分かりやすい可視化
  - [ ] Homeに戻るボタン
- **テスト要件**:
  - [ ] コンポーネントテスト
  - [ ] E2Eテスト: 集計表示と遷移

#### TASK-205: 学習履歴表示へのカテゴリ追加

- [x] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: REQ-009
- **依存タスク**: TASK-204
- **実装詳細**:
  - 学習履歴のデータモデルにカテゴリ情報を追加
  - 集計画面の表示を修正し、各学習履歴にカテゴリが表示されるようにする
  - 集計画面の表示を修正し、各学習履歴にカテゴリが表示されるようにする
- **テスト要件**:
  - [x] 更新された集計画面のコンポーネントテスト
  - [x] カテゴリ表示を含む学習履歴のE2Eテスト
- **UI/UX要件**:
  - [x] 各学習履歴のカテゴリを明確に表示する

#### TASK-206: DB切り替え機能の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: ADR-0003
- **依存タスク**: TASK-201
- **実装詳細**:
  - 複数の問題集（データベース）を切り替える機能を追加する。
- **サブタスク**:
  - [x] `interface/extra_data.mjs` を作成し、新しい問題集データを定義する。
  - [x] `indexedDB_ffi.mjs` を修正し、`dbName` に応じて動的に問題集データ (`data.mjs` or `extra.mjs`) をインポートするように変更する。
  - [x] `indexedDB.gleam` を修正し、`setup`関数のシグネチャに`data_set_name`引数を追加する。
  - [x] `quiz_home.gleam` を修正し、UIにDB選択のドロップダウンを追加し、選択に応じてDBを再初期化するロジックを実装する。
  - [x] `indexedDB_test.gleam` を更新し、DB切り替え機能が正しく動作することを確認するテストケースを追加する。
- **完了条件**:
  - [x] UIから問題集を切り替えると、表示される問題が正しく変更される。
  - [ ] 新しい問題集に対するテストがすべてパスする。

#### TASK-207: 学習履歴のIndexedDBへの保存

- [x] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: ADR-0004
- **依存タスク**: TASK-203
- **実装詳細**:
  - `QuizResult`データモデルを定義し、IndexedDBに`quiz_results`オブジェクトストアを追加。
  - リザルト画面からHome画面への遷移時に`QuizResult`を保存するロジックを実装。
- **テスト要件**:
  - [x] `QuizResult`がIndexedDBに正しく保存されることを確認する単体テスト。
- **完了条件**:
  - [x] クイズ完了後、学習履歴がIndexedDBに保存される。

#### TASK-208: 未回答クイズフィルター機能の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: ADR-0005
- **依存タスク**: TASK-207
- **実装詳細**:
  - `quiz_home.gleam` の `Model` にフィルターの状態 (`unanswered_only: Bool`) を追加する。
  - `view` に「未回答の問題のみ」チェックボックスを追加する。
  - `update` にチェックボックス操作を処理する `Msg` を追加する。
  - `filtering_question_id` 関数を修正し、`quiz_results` を参照して未回答の問題のみを抽出するロジックを追加する。
- **テスト要件**:
  - [ ] フィルターが有効な場合に、回答済みの問題が正しく除外されることを確認する単体テスト。
  - [ ] UIからフィルターを操作し、選択される問題数が正しく変わることを確認するE2Eテスト。
- **完了条件**:
  - [ ] UIから「未回答の問題のみ」フィルターを有効にすると、未回答の問題のみがクイズ対象となる。
  - [ ] フィルターを無効にすると、すべての問題がクイズ対象に戻る。

### フェーズ4: 統合・最適化
#### TASK-209: リザルト画面からHome画面に戻った際の設定保持

- [x] **タスク完了**
- **タスクタイプ**: DIRECT
- **要件リンク**: ADR-0006
- **依存タスク**: TASK-203
- **実装詳細**:
  - `study_app.gleam` の `Model` を変更し、`QuizScreen` と `QuizResult` が `quiz_home.Model` を保持するようにする。
  - `update` 関数を修正し、リザルト画面からHome画面への遷移時に、保持していた `quiz_home.Model` を再利用する。
  - Home画面に戻る際に、最新の学習履歴を再取得する処理を追加する。
- **テスト要件**:
  - [ ] E2Eテスト: リザルト画面からHomeに戻った際に、カテゴリやオプションの選択状態が保持されていることを確認する。
- **完了条件**:
  - [x] リザルト画面からHome画面に戻ったときに、クイズの選択条件が保持されている。

#### TASK-301: 学習履歴リセット機能の実装

- [ ] **タスク完了**
- **タスクタイプ**: TDD
- **要件リンク**: ADR-0007
- **依存タスク**: TASK-207
- **実装詳細**:
  - `quiz_home.gleam` に「学習履歴をリセット」ボタンを追加する。
  - `indexedDB_ffi.mjs` に `quiz_results` ストアをクリアする `resetQuizResults` 関数を追加する。
  - ボタンクリック時に `resetQuizResults` を呼び出し、成功したら `quiz_home` の状態を更新して表示に反映させる。
- **テスト要件**:
  - [ ] `resetQuizResults` が `quiz_results` ストアをクリアすることを確認する単体テスト。
  - [ ] UIからリセットボタンを押すと、学習履歴がリセットされ、関連する表示（例: 未回答フィルター）が正しく更新されることを確認するE2Eテスト。
- **完了条件**:
  - [ ] UIから学習履歴をリセットできる。

### フェーズ5: Firestore移行
